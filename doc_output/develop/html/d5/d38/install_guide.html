<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.8"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Leosac: Installation guide</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Leosac </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Installation guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#install_guide_goals">Goals </a></li>
<li class="level1"><a href="#install_guide_req">Requirements </a><ul><li class="level2"><a href="#install_guide_req_hard">Hardware </a></li>
<li class="level2"><a href="#install_guide_req_soft">Software </a></li>
</ul>
</li>
<li class="level1"><a href="#install_guide_getting_started">Getting Started </a></li>
<li class="level1"><a href="#install_guide_installing">Installing Leosac </a><ul><li class="level2"><a href="#install_guide_installing_src">From Source </a></li>
<li class="level2"><a href="#install_guide_installing_deb">Debian Package </a></li>
</ul>
</li>
<li class="level1"><a href="#install_guide_basic_cfg">Basic Configuration </a></li>
<li class="level1"><a href="#install_guide_add_mod">Adding modules </a><ul><li class="level2"><a href="#install_guide_add_mod_piface">Configuring the Piface Digital module </a></li>
<li class="level2"><a href="#install_guide_add_mod_wiegand">Configure the Wiegand module </a></li>
<li class="level2"><a href="#install_guide_add_mod_auth_file">Configure the auth-file module </a></li>
<li class="level2"><a href="#install_guide_add_mod_doorman">Configuring the doorman module </a></li>
</ul>
</li>
<li class="level1"><a href="#install_guide_wiring">Wiring everything </a></li>
<li class="level1"><a href="#install_guide_end">Conclusion </a></li>
</ul>
</div>
<div class="textblock"><p>Describe the installation process when using a Raspberry PI + Piface Board + Wiegand Reader.</p>
<p>This tutorial describes the full install process of Leosac on Raspbian. It will walk you through a complete install on a Raspbian system.</p>
<h1><a class="anchor" id="install_guide_goals"></a>
Goals </h1>
<p>The goals of this tutorial is to end-up with a simple and working setup.</p>
<p>You'll have the ability to control a <b>door</b>. A <b>card reader</b> will read your input card, and Leosac (running on a <b>Raspberry Pi</b>) will take care of orchestrating the whole thing.</p>
<h1><a class="anchor" id="install_guide_req"></a>
Requirements </h1>
<p>Here is a list of requirements, both hardware and software. The hardware requirements hard requirements for this tutorial to work.</p>
<h2><a class="anchor" id="install_guide_req_hard"></a>
Hardware </h2>
<ol type="1">
<li>A Raspberry Pi (and a SD card).</li>
<li>A Piface Digital board (see <a href="http://www.piface.org.uk/products/piface_digital/">here</a>).</li>
<li>A Wiegand card reader.</li>
<li>A Door.</li>
</ol>
<h2><a class="anchor" id="install_guide_req_soft"></a>
Software </h2>
<ol type="1">
<li>A SD card with a dumped Raspbian image.</li>
<li>GCC 4.8+ (any C++11-compatible compiler should do)</li>
<li>Git (to clone the repo)</li>
<li>CMake 2.8.12 (and above)</li>
<li>Boost 1.41 (and above)</li>
<li>TCLAP</li>
<li>GoogleTest is required if you plan to build the test suite.</li>
</ol>
<p><b>Note:</b> Leosac will work with something else than Raspbian, but some steps may change. If you know what you are doing and are fluent with Linux you shouldn't have any problem following this guide even if you don't use Raspbian.</p>
<h1><a class="anchor" id="install_guide_getting_started"></a>
Getting Started </h1>
<p>There is 2 thing to make sure before installing Leosac:</p><ol type="1">
<li>You have an updated system. Run <code>apt-get update &amp;&amp; apt-get upgrade</code> to make sure of this.</li>
<li>The SPI kernel module is installed. The PifaceDigital card needs this module to work.<br />
 On Raspbian you can turn it on using <code>raspi-config</code> &ndash;&gt; <code>Advanced Options</code> &ndash;&gt; <code>SPI</code>.<br />
 Otherwise you can try to manually load the module: <code>modprobe spi_bcm2708</code>.</li>
</ol>
<h1><a class="anchor" id="install_guide_installing"></a>
Installing Leosac </h1>
<p>You have your first choice to make:</p><ol type="1">
<li>Building from source.</li>
<li>Using the provided .deb package.</li>
</ol>
<h2><a class="anchor" id="install_guide_installing_src"></a>
From Source </h2>
<p>If you chose to build from source, follow <a href="https://github.com/islog/leosac/wiki/Build-and-install">this guide</a>. Note that building on Raspberry Pi will take quite a while, and cross compiling is out of scope for this guide.</p>
<h2><a class="anchor" id="install_guide_installing_deb"></a>
Debian Package </h2>
<p>Grab the latest armhf package from the <a href="https://github.com/islog/leosac/releases">Github Release tab</a>. Install the package and install missing dependencies:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;apt-get update;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;dpkg -i leosac_armhf.deb;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;apt-get install -f;</div>
</div><!-- fragment --><p>Before going to the next step, make sure you can launch the <code>leosac</code> binary (ie, that it is available in your PATH).</p>
<h1><a class="anchor" id="install_guide_basic_cfg"></a>
Basic Configuration </h1>
<p>Okay, so we now have Leosac installed. It needs to be configured before being useful. Below is a base configuration file:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?xml version=&quot;1.0&quot;?&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;kernel&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;plugin_directories&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        &lt;plugindir&gt;/usr/lib/leosac&lt;/plugindir&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;plugindir&gt;/usr/lib/leosac/auth&lt;/plugindir&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/plugin_directories&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;network&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &lt;enabled&gt;false&lt;/enabled&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &lt;/network&gt;        </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &lt;modules&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &lt;module&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            &lt;name&gt;MODULE_NAME&lt;/name&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            &lt;file&gt;SHARED_LIBRARY_FILE&lt;/file&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            &lt;level&gt;41&lt;/level&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &lt;module_config&gt;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            &lt;/module_config&gt;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        &lt;/module&gt;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    &lt;/modules&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;&lt;/kernel&gt;</div>
</div><!-- fragment --><p>Explanations:</p><ul>
<li><code>plugin_dir</code> is a folder use to try and find Leosac's dynamic libraries (aka modules). This path will NOT be search recursively.<br />
</li>
<li><code>network</code> configure the network. Unless you need to, we recommend you leave it disabled and configure networking through your system utility (<code>/etc/network/interfaces</code> or whatever you use).</li>
<li>For modules:<ol type="1">
<li>The <code>name</code> is at your discretion, but it make to use something close to the shared library file.</li>
<li><code>file</code> is the name of the shared library (<code>.so</code>) file.</li>
<li><code>level</code> is the order of module loading. The closer to 0 it is, the sooner the module will be load.</li>
<li><code>module_config</code> is for per-module specific configuration information.</li>
</ol>
</li>
</ul>
<p><b>MAKE SURE YOU DONT USE THE SAME <code>LEVEL</code> TWICE</b></p>
<hr/>
<h1><a class="anchor" id="install_guide_add_mod"></a>
Adding modules </h1>
<p>We need a few modules to make thing works:</p><ul>
<li>Since we are using the PifaceDigital card, we need Leosac's <a class="el" href="../../da/da3/mod_piface_main.html">piface digital</a> module.</li>
<li>We also need the <a class="el" href="../../d6/dad/mod_wiegand_main.html">wiegand module</a> to interact with the card reader.</li>
<li>The <a class="el" href="../../d0/d25/mod_auth_file_main.html">file auth</a> module will be used to grant (or deny) access after receiving data rom the card reader. This module will also store our card and time slice configuration.</li>
<li>Last but not least, we need the <a class="el" href="../../d6/d2b/mod_doorman_main.html">doorman</a> module to react to an authentication attempt.</li>
</ul>
<p>We will do this step by step, as modules configuration will depends on our hardware.</p>
<h2><a class="anchor" id="install_guide_add_mod_piface"></a>
Configuring the Piface Digital module </h2>
<p>You can find the documentation of the module <a class="el" href="../../da/da3/mod_piface_main.html">here</a>. It focus on how to configure the module for any use case. We will instead explain why we need a given configuration.</p>
<p>We are using a Wiegand card reader. Therefore we need 2 INPUTs GPIO. We also have 1 OUTPUT gpio for the door.</p>
<p>We add this to our config file:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;module&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;name&gt;PIFACEDIGITAL_GPIO&lt;/name&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;file&gt;libpifacedigital.so&lt;/file&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;level&gt;2&lt;/level&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;module_config&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;gpios&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            &lt;gpio&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                &lt;name&gt;my_door_gpio&lt;/name&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                &lt;no&gt;3&lt;/no&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                &lt;direction&gt;out&lt;/direction&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                &lt;value&gt;false&lt;/value&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            &lt;/gpio&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            &lt;gpio&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                &lt;name&gt;wiegand_data_high&lt;/name&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                &lt;no&gt;4&lt;/no&gt;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                &lt;direction&gt;in&lt;/direction&gt;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            &lt;/gpio&gt;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            &lt;gpio&gt;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                &lt;name&gt;wiegand_data_low&lt;/name&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                &lt;no&gt;2&lt;/no&gt;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                &lt;direction&gt;in&lt;/direction&gt;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            &lt;/gpio&gt;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        &lt;/gpios&gt;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    &lt;/module_config&gt;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;&lt;/module&gt;</div>
</div><!-- fragment --><p>As you can see, we are defining GPIO using the gpio port <code>&lt;no&gt;</code> we wired our reader and door. !IMAGE HERE!</p>
<p>Note that we use <code>&lt;level&gt;2&lt;/level&gt;</code> to make sure this module is one of the first to start. We are assigning meaningful name to our GPIO. Keep them in mind because we will reuse them later.</p>
<h2><a class="anchor" id="install_guide_add_mod_wiegand"></a>
Configure the Wiegand module </h2>
<p>Now that our configured GPIO are available to the rest of the application, we can configure the module that will understand our Wiegand Card Reader.</p>
<p>We have 1 reader to configure, and we will use both INPUT pin: <code>wiegand_data_low</code> and <code>wiegand_data_high</code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;module&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;name&gt;WIEGAND&lt;/name&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;file&gt;libwiegand.so&lt;/file&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;level&gt;5&lt;/level&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;module_config&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;readers&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            &lt;reader&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                &lt;name&gt;MY_WIEGAND_1&lt;/name&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                &lt;high&gt;wiegand_data_high&lt;/high&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                &lt;low&gt;wiegand_data_low&lt;/low&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                &lt;green_led&gt;&lt;/green_led&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                &lt;buzzer&gt;&lt;/buzzer&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            &lt;/reader&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        &lt;/readers&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &lt;/module_config&gt;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;/module&gt;</div>
</div><!-- fragment --><p>As you can see, we are re-using <code>wiegand_data_low</code> and <code>wiegand_data_high</code>. We assign them to our reader (<code>MY_WIEGAND_1</code>). <b>Note</b>: Most wiegand card readers also have a green led and a buzzer than you can activate. We are not using them in this tutorial, we are leaving them out in the configuration.</p>
<h2><a class="anchor" id="install_guide_add_mod_auth_file"></a>
Configure the auth-file module </h2>
<p>In every access control system we need a component that is able to determine if an access should be granted or denied. This is what the <a class="el" href="../../d0/d25/mod_auth_file_main.html">auth file</a> module is doing.</p>
<p>For this module we need a new configuration file, dedicated to this module only. This file will holds cards informations, group and user mapping and time slice informations.</p>
<p>Lets say this file is named "auth.xml".</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;root&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;users&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        &lt;user&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;            &lt;name&gt;MY_USER&lt;/name&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &lt;/user&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;/users&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;credentials&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &lt;map&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;            &lt;user&gt;MY_USER&lt;/user&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            &lt;WiegandCard&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                &lt;card_id&gt;80:83:a0:40&lt;/card_id&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                &lt;bits&gt;32&lt;/bits&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            &lt;/WiegandCard&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        &lt;/map&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        &lt;map&gt;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            &lt;user&gt;MY_USER&lt;/user&gt;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            &lt;PINCode&gt;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                &lt;pin&gt;1234&lt;/pin&gt;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            &lt;/PINCode&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        &lt;/map&gt;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    &lt;/credentials&gt;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    &lt;schedules&gt;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        &lt;schedule&gt;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;            &lt;name&gt;all&lt;/name&gt;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            &lt;monday&gt;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                &lt;start&gt;00:00&lt;/start&gt;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                &lt;end&gt;23:59&lt;/end&gt;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            &lt;/monday&gt;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            &lt;tuesday&gt;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                &lt;start&gt;00:00&lt;/start&gt;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                &lt;end&gt;23:59&lt;/end&gt;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            &lt;/tuesday&gt;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            &lt;wednesday&gt;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                &lt;start&gt;00:00&lt;/start&gt;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                &lt;end&gt;23:59&lt;/end&gt;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            &lt;/wednesday&gt;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            &lt;sunday&gt;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                &lt;start&gt;00:00&lt;/start&gt;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                &lt;end&gt;23:59&lt;/end&gt;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            &lt;/sunday&gt;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        &lt;/schedule&gt;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    &lt;/schedules&gt;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    &lt;schedules_mapping&gt;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        &lt;map&gt;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            &lt;schedule&gt;all&lt;/schedule&gt;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            &lt;user&gt;MY_USER&lt;/user&gt;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        &lt;/map&gt;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    &lt;/schedules_mapping&gt;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;&lt;/root&gt;</div>
</div><!-- fragment --><p>For more information about the authentication and authorization config file, you can read <a class="el" href="../../d0/d25/mod_auth_file_main.html">this</a>.</p>
<p>To enable this module, we also need to add something in the main configuration file. This something looks like this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;module&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;name&gt;AUTH_FILE&lt;/name&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;file&gt;libauth-file.so&lt;/file&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;level&gt;41&lt;/level&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;module_config&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;instances&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            &lt;instance&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                &lt;name&gt;AUTH_CONTEXT_1&lt;/name&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                &lt;auth_source&gt;MY_WIEGAND_1&lt;/auth_source&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                &lt;config_file&gt;auth.xml&lt;/config_file&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                &lt;target&gt;doorA&lt;/target&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            &lt;/instance&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &lt;/instances&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &lt;/module_config&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;&lt;/module&gt;</div>
</div><!-- fragment --><p>The <code>&lt;target&gt;</code> match <code>&lt;door&gt;</code> in the <code>auth.xml</code> file. <code>&lt;auth_source&gt;</code> is the name of the reader that will generate access attempt.</p>
<p>When an attempt is detect, this module will analyze it and either grant the access, or deny it. This response is then read by the doorman module.</p>
<h2><a class="anchor" id="install_guide_add_mod_doorman"></a>
Configuring the doorman module </h2>
<p>At last, we need to react to those "grant access" or "deny access" from the auth module. In our scenario, we want to open the door for a few seconds when an access is successful. In case an access is failed, we do nothing. This is easy to do using the doorman module.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;module&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;name&gt;DOORMAN&lt;/name&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &lt;file&gt;libdoorman.so&lt;/file&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;level&gt;50&lt;/level&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &lt;module_config&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &lt;instances&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            &lt;instance&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                &lt;name&gt;A_DOORMAN_INSTANCE&lt;/name&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                &lt;auth_contexts&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                    &lt;auth_context&gt;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                        &lt;name&gt;AUTH_CONTEXT_1&lt;/name&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                    &lt;/auth_context&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                &lt;/auth_contexts&gt;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                &lt;actions&gt;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                    &lt;action&gt;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                        &lt;on&gt;GRANTED&lt;/on&gt;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                        &lt;target&gt;my_door_gpio&lt;/target&gt;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                        &lt;cmd&gt;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                            &lt;f1&gt;ON&lt;/f2&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                            &lt;f2&gt;3000&lt;/f3&gt;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                        &lt;/cmd&gt;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                    &lt;/action&gt;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                &lt;/actions&gt;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;            &lt;/instance&gt;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        &lt;/instances&gt;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    &lt;/module_config&gt;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;&lt;/module&gt;</div>
</div><!-- fragment --><p>We are defining an action that will target <code>my_door_gpio</code> and send the <code>ON</code> command for <code>3000</code> ms.</p>
<h1><a class="anchor" id="install_guide_wiring"></a>
Wiring everything </h1>
<p>This is the board with the PiFace plug onto it. </p><div class="image">
<img src="../../../resources/piface-front.png"  alt="Raspi and board"/>
</div>
<p> The orange port are output ports. Green ports are for inputs.</p>
<p>We have 3 wire to connect:</p><ol type="1">
<li>Brown wire is our OUTPUT wire, connected to the door.</li>
<li>Purple wire is wiegand low.</li>
<li>Yellow wire is wiegand high.</li>
</ol>
<div class="image">
<img src="../../../resources/piface-wire.png"  alt="Raspi wired"/>
</div>
<h1><a class="anchor" id="install_guide_end"></a>
Conclusion </h1>
<p>This is theoretically easy and should work. The whole configuration file can be found in <code>cfg/example/guide_rpi_piface_wiegand/</code>. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 21 2015 10:43:44 for Leosac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
